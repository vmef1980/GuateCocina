<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <meta name="theme-color" content="#F47C20" />
  <title>Carrito - GuateCocina</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" />
  <link rel="icon" href="img/GuateCocina.ico" type="image/x-icon">
  <style>
    :root{
      --p:#F47C20;--pd:#00A86F;--a:#0074B7;--t:#1C3F60;--ts:#666;--b:rgba(0,0,0,0.08);
      --s:0 0 8px 32px rgba(0,0,0,0.08);--radius:16px;--transition:all .3s ease;
    }
    *{margin:0;padding:0;box-sizing:border-box}
    body{
      font-family:'Inter',sans-serif;
      background:linear-gradient(135deg,#fff8f0,#e6f7ff);
      color:var(--t);
      min-height:100vh;
      padding:1rem 0.8rem 160px;
      font-size:15px;
      line-height:1.5;
    }

    .c{
      max-width:900px;
      margin:0 auto;
      background:white;
      border-radius:20px;
      overflow:hidden;
      box-shadow:var(--s);
    }

    header{
      background:var(--p);
      color:white;
      padding:1.2rem 1rem;
      text-align:center;
    }
    header img.logo{
      width:120px;
      height:auto;
      margin-bottom:0.4rem;
      border-radius:10px;
    }
    header h1{
      margin:0;
      font-size:1.7rem;
      font-weight:700;
    }

    /* === RESPONSIVE PARA MÓVIL === */
    @media (max-width:480px){
      body{padding:0.8rem 0.6rem 160px;font-size:14.5px}
      header{padding:1rem 0.8rem}
      header h1{font-size:1.55rem}
      header img.logo{width:110px}
    }

    .i{
      display:flex;
      align-items:center;
      gap:0.9rem;
      padding:0.9rem;
      border-bottom:1px solid var(--b);
      position:relative;
      flex-wrap:wrap;
    }
    .i img{width:70px;height:70px;object-fit:contain;border-radius:12px;background:#f9f9f9}
    .q{
      background:var(--p);color:white;
      width:24px;height:24px;border-radius:50%;
      font-size:0.8rem;font-weight:700;
      position:absolute;top:6px;left:6px;
      display:flex;align-items:center;justify-content:center;
    }
    .info h3{font-size:1.05rem;margin-bottom:0.3rem}
    .pr{color:var(--p);font-weight:700;font-size:1.1rem}
    .x{
      width:36px;height:36px;border-radius:50%;
      background:#e74c3c;color:white;
      font-size:1.4rem;line-height:35px;
      flex-shrink:0;
    }

    .se{
      background:#f8f9fb;
      padding:1.2rem;
      border-radius:16px;
      margin:1.2rem 1rem;
    }
    .se h3{
      margin:0 0 0.9rem;
      color:var(--a);
      font-size:1.15rem;
    }
    select, textarea{
      width:100%;
      padding:0.9rem;
      border-radius:12px;
      border:1.5px solid var(--b);
      font-size:1rem;
      margin:0.4rem 0;
    }
    select:focus, textarea:focus{
      outline:none;
      border-color:var(--p);
      box-shadow:0 0 0 3px rgba(244,124,32,.2);
    }
    textarea{min-height:85px}

    .n{
      padding:0.8rem;
      background:#e3f2fd;
      border-radius:10px;
      font-size:0.88rem;
      margin-top:0.6rem;
      color:#1565c0;
      border-left:4px solid #42a5f5;
    }

    .r{
      background:#f0f8ff;
      padding:1.2rem;
      border-radius:16px;
      margin:1rem;
      font-size:1rem;
    }
    .l{
      display:flex;
      justify-content:space-between;
      margin:0.6rem 0;
      font-size:0.98rem;
    }
    .tot{
      font-size:1.4rem;
      font-weight:700;
      color:var(--p);
      border-top:2px solid var(--p);
      padding-top:0.8rem;
      margin-top:0.8rem;
    }

    .btn, .btn-vaciar{
      margin:1rem 1rem 0;
      padding:1rem;
      border-radius:14px;
      font-size:1.1rem;
      font-weight:600;
      width:calc(100% - 2rem);
      transition:var(--transition);
    }
    .btn{background:var(--p);color:white}
    .btn:hover{background:var(--pd);transform:translateY(-2px)}
    .btn-vaciar{
      background:#e74c3c;
      color:white;
      display:flex;
      align-items:center;
      justify-content:center;
      gap:8px;
    }

    /* BOTÓN VOLVER AL INICIO */
    #boton-volver{
      position:fixed;
      bottom:90px;
      right:16px;
      background:rgba(255,255,255,0.95);
      color:var(--t);
      padding:0.75rem 1.4rem;
      border-radius:50px;
      font-weight:600;
      font-size:0.95rem;
      box-shadow:0 8px 32px rgba(0,0,0,0.1);
      backdrop-filter:blur(12px);
      border:1px solid var(--b);
      z-index:1000;
      text-decoration:none;
      display:flex;
      align-items:center;
      gap:8px;
    }
    #boton-volver i{font-size:1.3rem}
    #boton-volver:hover{background:var(--p);color:white}

    /* FOOTER */
    footer{
      position:fixed;bottom:0;left:0;right:0;
      background:rgba(255,255,255,0.98);backdrop-filter:blur(16px);
      padding:1.3rem 1rem;
      text-align:center;
      font-size:0.8rem;
      color:var(--ts);
      border-top:1px solid var(--b);
      z-index:999;
    }
    footer p{margin:0.25rem 0;font-size:0.58rem}
    footer a{color:var(--p);text-decoration:none}
  </style>
</head>
<body>

  <div class="c">
    <header>
      <img src="img/GuateCocina_LogoConNombre-PNGtoICO.png" alt="GuateCocina" class="logo">
      <h1>Tu Carrito</h1>
    </header>

    <div id="lista"></div>

    <div id="lleno" style="display:none">
      <div class="se">
        <h3>Zona de Entrega</h3>
        <select id="zona">
          <option value="25">Ciudad de Guatemala - Q25</option>
          <option value="35">Mixco, Fraijanes, Villa Nueva, etc. - Q35</option>
          <option value="40" selected>Departamentos (todo el país) - Q40</option>
        </select>
        <div class="n"><strong>Nota:</strong> El costo de envío es base. Puede variar ±Q5-Q15. ¡Te lo confirmamos por WhatsApp!</div>

        <h3 style="margin-top:1.3rem">Método de Pago</h3>
        <div class="op"><label><input type="radio" name="pago" value="t" checked><span>Transferencia / Depósito Bancario</span></label></div>
        <div class="op"><label><input type="radio" name="pago" value="c"><span>Contraentrega <span style="color:#e74c3c;font-weight:bold">(+5% solo en departamentos)</span></span></label></div>

        <h3 style="margin-top:1.3rem">Notas del pedido <small style="color:#666">(opcional)</small></h3>
        <textarea id="notas" placeholder="Ej. Llamar al 5555-1234 • Dejar con el guardia • Entregar después de las 4 pm"></textarea>
      </div>

      <div class="r">
        <div class="l"><span>Subtotal:</span> <strong id="sub">Q0.00</strong></div>
        <div class="l"><span>Envío:</span> <strong id="env">Q40.00</strong></div>
        <div class="l" id="rec" style="display:none;color:#e74c3c"><span>Recargo contraentrega (5%):</span> <strong id="re">Q0.00</strong></div>
        <div class="l tot"><span>Total a pagar:</span> <strong id="tot">Q40.00</strong></div>
      </div>

      <button class="btn-vaciar" onclick="vaciarCarrito()">Vaciar carrito</button>
      <button class="btn" onclick="fin()">Enviar pedido por WhatsApp</button>
    </div>

    <div id="vacio" style="text-align:center;padding:4.5rem 1.5rem;display:none">
      <h2>Tu carrito está vacío</h2>
      <p style="margin-top:1rem"><a href="index.html" style="color:var(--a);font-weight:600;text-decoration:underline">Volver a la tienda</a></p>
    </div>
  </div>

<a href="index.html" id="boton-volver">
  <i class="bi bi-house-door-fill"></i> Volver al inicio
</a>

  <footer>
    <p>© 2025 <strong>Rompecabezas de Guatemala</strong></p>
    <p>Desarrollado por <strong>Rompecabezas de Guatemala</strong>
      <a href="https://wa.me/50241084481" target="_blank">
        <i class="bi bi-whatsapp"></i>
      </a>
    </p>
  </footer>

  <!-- SCRIPT SIN CAMBIOS -->
  <script>
    const $ = s => document.getElementById(s);
    const zona = $('zona');
    const notas = $('notas');

    const notasGuardadas = localStorage.getItem("notasPedido");
    if (notasGuardadas) notas.value = notasGuardadas;

    const ajustarAltura = () => {
      notas.style.height = "auto";
      notas.style.height = (notas.scrollHeight + 4) + "px";
    };
    notas.addEventListener("input", () => {
      clearTimeout(window.notasTimeout);
      window.notasTimeout = setTimeout(() => {
        const valor = notas.value.trim();
        if (valor) localStorage.setItem("notasPedido", valor);
        else localStorage.removeItem("notasPedido");
        ajustarAltura();
      }, 300);
    });
    setTimeout(ajustarAltura, 100);

    const agrupar = () => {
      const map = {};
      JSON.parse(localStorage.getItem("carrito")||"[]").forEach(p => {
        map[p.id] ? (map[p.id].c += 1, map[p.id].t += p.precio) : (map[p.id] = {...p, c:1, t:p.precio});
      });
      return Object.values(map);
    };

    const act = () => {
      const items = agrupar();
      $('lista').innerHTML = "";
      if (!items.length) {
        $('vacio').style.display = "block";
        $('lleno').style.display = "none";
        return;
      }
      $('vacio').style.display = "none";
      $('lleno').style.display = "block";

      items.forEach(i => {
        $('lista').innerHTML += `
          <div class="i">
            ${i.c>1 ? `<div class="q">${i.c}</div>` : ''}
            <img src="${i.imagen||'img/placeholder.png'}" alt="${i.titulo}">
            <div class="info flex-grow">
              <h3>${i.titulo}</h3>
              <p class="pr">Q${i.t.toFixed(2)} ${i.c>1?`(Q${i.precio.toFixed(2)} c/u)`:""}</p>
            </div>
            <button class="x" onclick="elim('${i.id}')">×</button>
          </div>`;
      });
      calc();
    };

    const calc = () => {
      const items = agrupar();
      const subtotal = items.reduce((a,b)=>a+b.t,0);
      const envio = +zona.value;
      const esDepartamento = envio === 40;
      const contraentrega = document.querySelector('input[value="c"]').checked;
      const recargo = (esDepartamento && contraentrega) ? (subtotal + envio) * 0.05 : 0;

      $('sub').textContent = `Q${subtotal.toFixed(2)}`;
      $('env').textContent = `Q${envio.toFixed(2)}`;
      $('rec').style.display = recargo ? "flex" : "none";
      $('re').textContent = `Q${recargo.toFixed(2)}`;
      $('tot').textContent = `Q${(subtotal + envio + recargo).toFixed(2)}`;
    };

    window.elim = id => {
      let c = JSON.parse(localStorage.getItem("carrito")||"[]");
      c = c.filter(p => p.id !== id);
      localStorage.setItem("carrito", JSON.stringify(c));
      act();
    };

    window.vaciarCarrito = () => {
      if (confirm("¿Vaciar todo el carrito?")) {
        localStorage.removeItem("carrito");
        localStorage.removeItem("notasPedido");
        notas.value = "";
        notas.style.height = "90px";
        act();
      }
    };

    window.fin = () => {
      const items = agrupar();
      const subtotal = items.reduce((a,b)=>a+b.t,0);
      const envio = +zona.value;
      const ztxt = zona.selectedOptions[0].text.split(" - ")[0];
      const esDepartamento = envio === 40;
      const contraentrega = document.querySelector('input[value="c"]').checked;
      const recargo = (esDepartamento && contraentrega) ? (subtotal + envio) * 0.05 : 0;
      const notasTexto = notas.value.trim();

      let m = "*¡Hola GuateCocina!*%0AMi pedido:%0A%0A";
      items.forEach(i => m += `• ${i.titulo} ×${i.c} - Q${i.t.toFixed(2)}%0A`);
      m += `%0A*Subtotal:* Q${subtotal.toFixed(2)}`;
      m += `%0A*Envío (${ztxt}):* Q${envio.toFixed(2)}`;
      if (recargo) m += `%0A*Recargo contraentrega (5%):* Q${recargo.toFixed(2)}`;
      m += `%0A%0A*TOTAL: Q${(subtotal + envio + recargo).toFixed(2)}*%0A%0A`;
      m += `*Pago:* ${contraentrega ? "Contraentrega (+5%)" : "Transferencia bancaria"}%0A`;
      if (notasTexto) m += `%0A*Notas:*%0A${encodeURIComponent(notasTexto)}%0A`;
      m += `%0A¡Gracias!`;

      open("https://wa.me/50241084481?text=" + m, "_blank");
      notas.value = "";
      localStorage.removeItem("notasPedido");
      notas.style.height = "90px";
    };

    zona.onchange = calc;
    document.querySelectorAll('input[name="pago"]').forEach(r => r.onclick = calc);
    act();
  </script>
</body>
</html>